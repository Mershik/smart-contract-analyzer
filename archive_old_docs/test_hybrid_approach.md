# Тест гибридного подхода "AI-Tagger + Взвешенный программный анализ"

## Что изменилось

### 1. Улучшенная функция classifyClauseParty
- Теперь возвращает не только `party` ("buyer", "supplier", "both", "neutral")
- Но и `type` права ("termination", "modification", "liability", "control", "procedural")
- Это позволяет AI дать нам больше качественной информации для анализа

### 2. Новая функция analyzeRightsImbalanceProgrammatically
- Использует веса для разных типов прав:
  - modification: 10 (самое сильное право)
  - liability: 8
  - termination: 7
  - control: 5
  - procedural: 2 (самое слабое право)
- Анализирует общий баланс по взвешенному счету
- Анализирует дисбаланс внутри каждой категории отдельно

### 3. Обновленная функция aggregateAndAnalyzeRights
- Проверяет наличие классифицированных пунктов в чанках
- Если есть - использует взвешенный анализ
- Если нет - использует простую логику (для обратной совместимости)

### 4. Обновленный промпт в analyzeChunk
- Теперь AI должен возвращать в `chunkRightsAnalysis` дополнительное поле `classifiedClauses`
- Каждый пункт с правами классифицируется по стороне и типу

## Ожидаемый результат

Вместо простого "10 на 10, баланс" мы получим детальный анализ:

1. **Взвешенный дисбаланс**: "Взвешенный счет Покупателя: 35, Поставщика: 58"
2. **Дисбаланс по категориям**: 
   - "Дисбаланс в сфере изменения условий: Прав Покупателя: 0, прав Поставщика: 2"
   - "Дисбаланс в сфере взыскания штрафов/неустоек: Прав Покупателя: 1, прав Поставщика: 3"

## Преимущества подхода

1. **Надежность**: Программный код делает основную работу по анализу
2. **Качество**: AI дает нам типизированную информацию о правах
3. **Детализация**: Анализ по категориям вместо общего подсчета
4. **Взвешивание**: Учитывается "сила" разных типов прав
5. **Совместимость**: Fallback на простую логику если AI не дал классификацию

## Архитектурная стабильность

- AI выполняет простую задачу классификации (высокая надежность)
- Программный код выполняет сложную логику анализа (100% надежность)
- Нет зависимости от генерации текста AI для критической логики