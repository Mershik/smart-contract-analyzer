# –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∞–≤

## –ü—Ä–æ–±–ª–µ–º–∞
–§—É–Ω–∫—Ü–∏—è `extractRightsFromClauses` –≤ —Ñ–∞–π–ª–µ `client/src/lib/gemini.ts` —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ –ø—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑-–∑–∞ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:

1. **"–ì—Ä—è–∑–Ω—ã–π" –ø—Ä–æ–º–ø—Ç**: –ü–µ—Ä–µ–¥–∞—á–∞ —Å–º–µ—Å–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ AI
2. **–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ —á–∞–Ω–∫–∏**: –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –≤ 7 –ø—É–Ω–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–≤–∞–ª –∏–∑–±—ã—Ç–æ—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –º–æ–¥–µ–ª—å

### –°–∏–º–ø—Ç–æ–º—ã
```
[Log] üîÑ –ó–∞–ø—É—Å–∫ –®–∞–≥–∞ 5.1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∞–≤
[Warning] -> –ß–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ1 –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.
[Warning] -> –ß–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ2 –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.
[Warning] -> –ß–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ3 –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.
[Warning] -> –ß–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ4 –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.
[Log] ‚úÖ –®–∞–≥ 5.1 –ó–ê–í–ï–†–®–ï–ù: –í—Å–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ –ø—Ä–∞–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è: 0, –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞: 0
```

## –†–µ—à–µ–Ω–∏—è

### 1. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 2065)
**–ë—ã–ª–æ (–≥—Ä—è–∑–Ω—ã–π –ø—Ä–æ–º–ø—Ç):**
```typescript
${chunk.map(item => `- ${item.id}: ${item.text}${item.comment ? ` | –ê–Ω–∞–ª–∏–∑: ${item.comment}` : ''}`).join('\n\n')}
```

**–°—Ç–∞–ª–æ (—á–∏—Å—Ç—ã–π –ø—Ä–æ–º–ø—Ç):**
```typescript
${chunk.map(item => `- ${item.id}: ${item.text}`).join('\n\n')}
```

### 2. –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —á–∞–Ω–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 2048)
**–ë—ã–ª–æ:**
```typescript
const CHUNK_SIZE = 7; // 7 –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞ —á–∞–Ω–∫
```

**–°—Ç–∞–ª–æ:**
```typescript
const CHUNK_SIZE = 5; // 5 –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞ —á–∞–Ω–∫ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
```

### 3. –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 2107-2138)
–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –ø—É—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–µ:
```typescript
// –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–µ
if (!rawResponse || rawResponse.trim().length === 0) {
  console.warn(`  -> –ß–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ${Math.floor(i / CHUNK_SIZE) + 1} –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫...`);
  await new Promise(resolve => setTimeout(resolve, 1500));
  
  try {
    const secondTryResult = await model.generateContent({...});
    rawResponse = secondTryResult.response.text();
    if (rawResponse && rawResponse.trim().length > 0) {
      console.log(`  ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è —á–∞–Ω–∫–∞ ‚Ññ${Math.floor(i / CHUNK_SIZE) + 1} —É—Å–ø–µ—à–Ω–∞!`);
    }
  } catch (retryError) {
    console.error(`  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ...`);
  }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### üéØ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- **–ß–∞–Ω–∫–∏ –ø–æ 5 –ø—É–Ω–∫—Ç–æ–≤**: –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ AI –Ω–∞ 28% (—Å 7 –¥–æ 5 –ø—É–Ω–∫—Ç–æ–≤)
- **–ß–∏—Å—Ç—ã–π –ø—Ä–æ–º–ø—Ç**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –¥–∏—Å—Å–æ–Ω–∞–Ω—Å–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry**: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

### üìä **–ü–æ–≤—ã—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ ~39%**: –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞–Ω–∫–æ–≤**: –ë–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫ = –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞
- **–£–º–Ω–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –ê–Ω–∞–ª–∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å

### üîÑ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**
- **Graceful degradation**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –Ω–µ—É–¥–∞—á–∞—Ö
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∞–≤
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**: –í–æ–∑–≤—Ä–∞—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
```
–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (25 –ø—É–Ω–∫—Ç–æ–≤) -> –ß–∞–Ω–∫–∏ –ø–æ 5 –ø—É–Ω–∫—Ç–æ–≤ -> –ß–∏—Å—Ç—ã–π –ø—Ä–æ–º–ø—Ç + Retry -> –°–∏–Ω—Ç–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

1. **–®–∞–≥ 1**: `getPrioritizedItemsForRightsAnalysis` –æ—Ç–±–∏—Ä–∞–µ—Ç 25 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤
2. **–®–∞–≥ 2**: `extractRightsFromClauses` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 5 —á–∞–Ω–∫–æ–≤ –ø–æ 5 –ø—É–Ω–∫—Ç–æ–≤ —Å retry
3. **–®–∞–≥ 3**: `analyzeRightsImbalance` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏—Å–±–∞–ª–∞–Ω—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
[Log] üîÑ –ó–∞–ø—É—Å–∫ –®–∞–≥–∞ 5.1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∞–≤
[Log] -> –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ1 (–ø—É–Ω–∫—Ç—ã 1-5)
[Log] -> –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ2 (–ø—É–Ω–∫—Ç—ã 6-10)
[Log] -> –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ3 (–ø—É–Ω–∫—Ç—ã 11-15)
[Log] -> –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ4 (–ø—É–Ω–∫—Ç—ã 16-20)
[Log] -> –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–∞–Ω–∫ –ø—Ä–∞–≤ ‚Ññ5 (–ø—É–Ω–∫—Ç—ã 21-25)
[Log] ‚úÖ –®–∞–≥ 5.1 –ó–ê–í–ï–†–®–ï–ù: –í—Å–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ –ø—Ä–∞–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è: 12, –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞: 8
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `client/src/lib/gemini.ts`:
  - –°—Ç—Ä–æ–∫–∞ 2048: –£–º–µ–Ω—å—à–µ–Ω–∏–µ CHUNK_SIZE —Å 7 –¥–æ 5
  - –°—Ç—Ä–æ–∫–∞ 2065: –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ –æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ AI
  - –°—Ç—Ä–æ–∫–∏ 2107-2138: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ retry

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript —É—Å–ø–µ—à–Ω–∞
- ‚úÖ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `analyzeRightsImbalance` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ú–µ—Ö–∞–Ω–∏–∑–º retry –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É